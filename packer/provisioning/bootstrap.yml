---
- hosts: localhost
  tasks:
    - name: Syncronize time
      command: timedatectl set-ntp true

    - name: Create BIOS boot partition
      command: "{{ item }}"
      with_items:
        - parted --script /dev/sda mklabel gpt
        - parted --script /dev/sda mkpart primary 0M 1M
        - parted --script /dev/sda set 1 bios_grub on

    - name: Partition root disk
      command: "{{ item }}"
      with_items:
        - parted --script /dev/sda mkpart primary btrfs 1M 100%
        - parted --script /dev/sda set 2 boot on

    - name: Format root disk
      command: mkfs.btrfs -L ROOTFS /dev/sda2

    - name: Mount root disk
      command: mount /dev/sda2 /mnt

    - name: Bootstrap new Arch disk
      command: pacstrap /mnt base openssh python grub

    - name: Generate new fstab
      shell: genfstab -U /mnt >> /mnt/etc/fstab

